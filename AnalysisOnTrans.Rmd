---
title: "Analysis on Transmission Type"
author: "Justin Pizzino"
date: "8/15/2019"
output: pdf_document
---

# 1. Executive Summary
Purpose of this research paper is to determine if an automatic or manual transmissions is better for MPG, and quantify that difference.  To do this we will use the Motor Trend data.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stats)
library(ggplot2)
library(car)
library(corrplot)
```

# 3. Load the data
First load the data, then convert the Transmission type (am) to Boolean, and split out cylinder into dummy variables.  Details in the appendix

```{r data, echo=FALSE, eval=TRUE}
data(mtcars)
mtcars<-mtcars
mtcars$am<-as.logical(mtcars$am)
mtcars$cyl.6<-as.logical(FALSE)
mtcars$cyl.6[ which(mtcars$cyl==6)]<-as.logical(TRUE)
mtcars$cyl.8<-as.logical(FALSE)
mtcars$cyl.8[ which(mtcars$cyl==8)]<-as.logical(TRUE)
```

# 4. Exploratory Data Analysis
Easy way to start is to do a direct compare of mpg to the transmission type.  From here it would appear that a manual transmission would add about 7.2 MPG.  We can see below that transmission is statistically significant with low p value, but it's adjusted r squared value is low, at only `r summary(lm(mpg~am,mtcars))$adj.r`  meaning only 33.8% of the data is explained by this model.
Futher more if we plot the residuals we can see there is something else going on with with the manual transmission.  Something else is impacting the results.  Coefficients below:
```{r mpgToam, fig.width=11, fig.height=4}
summary(lm(mpg~am,mtcars))$coef
```
```{r mpgToamPlot, fig.width=11, fig.height=4,echo=FALSE, eval=TRUE}
ggplot(data.frame(x=as.factor(mtcars$am), y=resid(lm(mpg~as.factor(am),mtcars))),
           aes(x=x,y=y))+
  geom_hline(yintercept = 0,size=2)+
  geom_point(size=7, colour="black", alpha=0.4)+
  geom_point(size=5,colour="red",alpha=0.4)+
  xlab("Trans")+ylab("Residual")+labs(title="Residual Plot of Trans to MPG")
```

# 5. Additional exploratory analysis using fit models & define strategy
So let's add more data points in to create a stronger model.
We know we should include other data, but need to determine which data points. Let's do some exploratory analysis.  I compared the correlation of each data point to it self.  
Here we can see that many other values that are correlated to MPG.  We need to factors those in to determine transmissions impact.
Weight, displacement, number of cyl, and engine shape (vs) all are very correlated to MPG, but also to each other.
```{r cor, fig.width=3, fig.height=3}
corrplot(cor(mtcars),method="square")
```

As weight has the highest correlation to MPG I choose that value to add to the model.
```{r addWt, fig.width=7,fig.height=7}
summary((lm(mpg~am+wt,mtcars)))$coef
summary((lm(mpg~am+wt,mtcars)))$adj.r.squared
```
Based on this model it would appear a manual transmission would reduce MPG by 0.02.  Also again, looking at the coefficient, each ton of weight decreases MPG by about 5.35.

Now that seems strange, our rss value went up, which is great, showing greater correlation between our model and observed data.  But the statistical significant of transmission type went down.  To understand why, created a plot of weight to mpg, with color coding for the two trans types.

```{r plot, fig.width=9, fig.height=4, echo=FALSE, eval=TRUE}
ggplot(mtcars, aes(wt, mpg))+
  geom_point(aes(col=as.factor(am)),size=5)+
  labs(title = "MPG to Weight with Trans",
       x="Weight in Tons",
       y="Miles per Gallon")+
  scale_colour_discrete(name="Trans",
                        labels=c("Manual","Auto"))

ggplot(data.frame(am=as.factor(mtcars$am),x=as.factor(mtcars$wt), y=resid(lm(mpg~wt+as.factor(am),mtcars))),
                 aes(x=x,y=y))+
  labs(title = "MPG to Weight with Trans",
       x="Weight in Tons",
       y="Miles per Gallon")+
  geom_hline(yintercept = 0,size=2)+
  geom_point(size=7, colour="black", alpha=0.4)+
  geom_point(size=5,alpha=0.4,aes(col=am))+
  xlab("Weight in Tons")+ylab("Residual")
```
With this plot we can now see that while MPG does go down with manual transmission, we also see that weight goes up, and appears to be the larger factor in impacting MPG.

# 6. Answer to the two questions
Based on the analysis done I would say it's possible an automatic transmission is better for MPG, by 0.02 MPG.  But based on the results, I would say, there is not enough data to determine the impact of transmission on MPG.  The p value is too low, and a majority of the change can be explained away by weight of the vehicle.

# 7. Appendix
## Libraries used
```{r libsApp, echo=TRUE, eval=FALSE}
library(stats)
library(ggplot2)
library(car)
library(corrplot)
```

## Code for the plot
```{r plotCodeApp, echo=FALSE,eval=TRUE}
# Resiual Trans to MPG
ggplot(data.frame(x=as.factor(mtcars$am), y=resid(lm(mpg~as.factor(am),mtcars))),
           aes(x=x,y=y))+
  geom_hline(yintercept = 0,size=2)+
  geom_point(size=7, colour="black", alpha=0.4)+
  geom_point(size=5,colour="red",alpha=0.4)+
  xlab("Trans")+ylab("Residual")+labs(title="Residual Plot of Trans to MPG")

# MPG to Weight with Trans
ggplot(mtcars, aes(wt, mpg))+
  geom_point(aes(col=as.factor(am)),size=5)+
  labs(title = "MPG to Weight with Trans",
       x="Weight in Tons",
       y="Miles per Gallon")+
  scale_colour_discrete(name="Trans",
                        labels=c("Manual","Auto"))
```

```{r dataApp, echo=TRUE, eval=FALSE}
data(mtcars)
mtcars<-mtcars
mtcars$am<-as.logical(mtcars$am)
mtcars$cyl.6<-as.logical(FALSE)
mtcars$cyl.6[ which(mtcars$cyl==6)]<-as.logical(TRUE)
mtcars$cyl.8<-as.logical(FALSE)
mtcars$cyl.8[ which(mtcars$cyl==8)]<-as.logical(TRUE)
```
